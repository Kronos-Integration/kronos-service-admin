{
  "name": "admin",
  "logLevel": "trace",
  "description": "flow administration",
  "type": "kronos-flow",
  "autostart": true,
  "steps": {
    "state": {
      "type": "kronos-aggregate",
      "aggregate": "by-endpoint-name",
      "endpoints": {
        "in": {
          "in": true
        },
        "state": {
          "out": true,
          "target": "health-check:state"
        },
        "memory": {
          "out": true,
          "target": "health-check:memory"
        },
        "uptime": {
          "out": true,
          "target": "health-check:uptime"
        }
      }
    },
    "http": {
      "type": "kronos-http-routing",
      "listener": "koa-admin",
      "mount": "/api",
      "endpoints": {
        "a": {
          "serviceName": "loadFlow",
          "path": "/flow",
          "method": "PUT",
          "target": "control/in",
          "interceptors": [{
            "type": "koa-request"
          }]
        },
        "b": {
          "path": "/flow/:id/start",
          "method": "POST",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "flow": "${id}",
              "action": "start"
            }
          }]
        },
        "c": {
          "path": "/flow/:id/stop",
          "method": "POST",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "flow": "${id}",
              "action": "stop"
            }
          }]
        },
        "d": {
          "path": "/flow/:id",
          "method": "DELETE",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "flow": "${id}",
              "action": "delete"
            }
          }]
        },
        "e": {
          "serviceName": "getFlow",
          "path": "/flow/:id",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "flow": "${id}",
              "action": "get",
              "options": {
                "includeName": true,
                "includeRuntimeInfo": true,
                "includeDefaults": false
              }
            }
          }]
        },
        "f": {
          "path": "/flow",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "action": "list"
            }
          }]
        },
        "g": {
          "path": "/service",
          "target": "kronos:command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "action": "list",
              "options": {
                "includeRuntimeInfo": true,
                "includeDefaults": false
              }
            }
          }]
        },
        "h": {
          "path": "/service/:id",
          "target": "kronos:command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "service": "${id}",
              "action": "get",
              "options": {
                "includeName": true,
                "includeRuntimeInfo": true,
                "includeDefaults": true,
                "includeConfig": true
              }
            }
          }]
        },
        "nodes": {
          "path": "/nodes/",
          "target": "registry:nodes",
          "mandatory": false,
          "interceptors": [{
            "type": "koa-data-request"
          }]
        },
        "software": {
          "path": "/software/",
          "target": "admin:software",
          "interceptors": [{
            "type": "koa-data-request"
          }]
        },
        "state_socket": {
          "path": "/state",
          "target": "state/in",
          "socket": true
        },
        "state_socket_incoming": {
          "path": "/state_incoming",
          "target": "health-check:stateBroadcast",
          "mandatory": false,
          "socket": true
        },
        "state": {
          "path": "/state/",
          "target": "state/in",
          "interceptors": [{
            "type": "koa-data-request"
          }]
        }
      }
    },
    "control": {
      "type": "kronos-flow-control"
    }
  }
}
