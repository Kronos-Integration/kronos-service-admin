{
  "name": "admin",
  "description": "kronos administration",
  "type": "kronos-flow",
  "autostart": true,
  "steps": {
    "state": {
      "type": "kronos-aggregate",
      "aggregate": "by-endpoint-name",
      "endpoints": {
        "in": {
          "in": true,
          "opposite": true
        },
        "state": {
          "out": true,
          "opposite": true,
          "target": "health-check:state"
        },
        "memory": {
          "out": true,
          "opposite": true,
          "target": "health-check:memory"
        },
        "cpu": {
          "out": true,
          "opposite": true,
          "target": "health-check:cpu"
        },
        "uptime": {
          "out": true,
          "opposite": true,
          "target": "health-check:uptime"
        }
      }
    },
    "http": {
      "type": "kronos-http-routing",
      "listener": "koa-admin",
      "mount": "/api",
      "endpoints": {
        "a": {
          "serviceName": "loadFlow",
          "path": "/:nodeid/flow",
          "method": "PUT",
          "target": "control/in",
          "interceptors": [{
            "type": "koa-request"
          }, {
            "type": "decode-json"
          }]
        },
        "b": {
          "path": "/:nodeid/flow/:id/start",
          "method": "POST",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "flow": "${id}",
              "action": "start"
            }
          }]
        },
        "c": {
          "path": "/:nodeid/flow/:id/stop",
          "method": "POST",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "flow": "${id}",
              "action": "stop"
            }
          }]
        },
        "d": {
          "path": "/:nodeid/flow/:id",
          "method": "DELETE",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "flow": "${id}",
              "action": "delete"
            }
          }]
        },
        "e": {
          "serviceName": "getFlow",
          "path": "/:nodeid/flow/:id",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "flow": "${id}",
              "action": "get",
              "options": {
                "includeName": true,
                "includeRuntimeInfo": true,
                "includeDefaults": false
              }
            }
          }]
        },
        "f": {
          "path": "/:nodeid/flow",
          "target": "control/command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "action": "list"
            }
          }]
        },
        "g": {
          "path": "/:nodeid/service",
          "target": "kronos:command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "action": "list",
              "options": {
                "includeRuntimeInfo": true,
                "includeDefaults": false
              }
            }
          }]
        },
        "h": {
          "path": "/:nodeid/service/:id",
          "target": "kronos:command",
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "service": "${id}",
              "action": "get",
              "options": {
                "includeName": true,
                "includeRuntimeInfo": true,
                "includeDefaults": true,
                "includeConfig": true
              }
            }
          }]
        },
        "node": {
          "path": "/node/",
          "target": "registry:command",
          "mandatory": false,
          "interceptors": [{
            "type": "koa-data-request",
            "data": {
              "action": "config"
            }
          }]
        },
        "nodes": {
          "path": "/nodes/",
          "target": "registry:nodes",
          "mandatory": false,
          "interceptors": [{
            "type": "koa-data-request"
          }]
        },
        "nodes_socket": {
          "path": "/nodes",
          "target": "registry:nodes",
          "mandatory": false,
          "socket": true
        },
        "nodes": {
          "path": "/kv/",
          "target": "registry:kv",
          "mandatory": false,
          "interceptors": [{
            "type": "koa-data-request"
          }]
        },
        "nodes_socket": {
          "path": "/kv",
          "target": "registry:kv",
          "mandatory": false,
          "socket": true
        },

        "software": {
          "path": "/:nodeid/software/",
          "target": "admin:software",
          "interceptors": [{
            "type": "koa-data-request"
          }]
        },
        "state_socket": {
          "path": "/state",
          "target": "state/in",
          "socket": true
        },
        "state": {
          "path": "/:nodeid/state/",
          "target": "state/in",
          "interceptors": [{
            "type": "koa-data-request"
          }]
        }
      }
    },
    "control": {
      "type": "kronos-flow-control"
    }
  }
}
